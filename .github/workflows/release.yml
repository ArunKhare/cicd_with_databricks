name: release

on:
  push:
    tags:
      - 'v*' # only release a versioned tag, such as v.X.Y.Z

jobs:
  deploy-production-jobs:
    runs-on: ubuntu-latest
    env:
      DATABRICKS_HOST: ${{ secrets['DATABRICKS_HOST_PRD'] }}
      DATABRICKS_TOKEN: ${{ secrets['DATABRICKS_TOKEN_PRD'] }}
      ENV: prd
      INTEGRATION_TEST: "NO"
      REPO_PATH: "/Repos/shivam.panicker@databricks.com/cicd_with_databricks/"

  linting:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v2.3.4
      - uses: actions/setup-python@v2

      - name: Installing Dependancies
        run: |
          pip install flake8
      
      - name: Running Linter flake8
        run: flake8

  unit-tests:
    needs:
      - linting
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v2
      - uses: actions/setup-python@v2

      - name: Installing Dependancies
        run: |
          pip install pyspark
          pip install delta-spark
      
      - name: Running Unit Tests
        run: |
          python -m unittest src/main/tests/